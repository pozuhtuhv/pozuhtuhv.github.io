---
# Jekyll layout that compresses HTML
# v3.0.4
# http://jch.penibelst.de/
# © 2014–2015 Anatol Broder
# MIT License
---

{% capture _LINE_FEED %}{% endcapture %}
{% if site.compress_html.ignore.envs contains jekyll.environment %}
  {{ content }}
{% else %}
  {% capture _content %}{{ content }}{% endcapture %}

  {%- assign _profile = site.compress_html.profile -%}

  {%- if site.compress_html.endings == "all" -%}
    {%- assign _endings = "html head body li dt dd optgroup option colgroup caption thead tbody tfoot tr td th" | split: " " -%}
  {%- else -%}
    {%- assign _endings = site.compress_html.endings -%}
  {%- endif -%}

  {%- for _element in _endings -%}
    {%- capture _end %}</{{ _element }}>{% endcapture -%}
    {%- assign _content = _content | remove: _end -%}
  {%- endfor -%}

  {%- if _profile and _endings -%}
    {%- assign _profile_endings = _content | size | plus: 1 -%}
  {%- endif -%}

  {%- for _element in site.compress_html.startings -%}
    {%- capture _start %}<{{ _element }}>{% endcapture -%}
    {%- assign _content = _content | remove: _start -%}
  {%- endfor -%}

  {%- if _profile and site.compress_html.startings -%}
    {%- assign _profile_startings = _content | size | plus: 1 -%}
  {%- endif -%}

  {%- if site.compress_html.comments == "all" -%}
    {%- assign _comments = "<!-- -->" | split: " " -%}
  {%- else -%}
    {%- assign _comments = site.compress_html.comments -%}
  {%- endif -%}

  {%- assign _pre_befores = _content | split: "<pre" -%}
  {%- assign _content = "" -%}

  {%- for _pre_before in _pre_befores -%}
    {%- assign _pres = _pre_before | split: "</pre>" -%}
    {%- capture _content %}{{ _content }}
      {%- if _pre_before contains "</pre>" -%}
        <pre{{ _pres.first }}</pre>
      {%- else -%}
        {{ _pres.last | split: " " | join: " " }}
      {%- endif -%}
    {% endcapture %}
  {%- endfor -%}

  {{ _content }}
{% endif %}
